NAME: CL

ON: WORKFLOW_DISPATCH

JOBS:

  BUILD:

    RUNS-ON: WINDOWS-LATEST

    TIMEOUT-MINUTES: 9999

    STEPS:

    - NAME: DOWNLOAD NGROK & NSSM

      RUN: |
        INVOKE-WEBREQUEST HTTPS://GITHUB.COM/AVGCHAMARA/WINDOWSRDP/RAW/MAIN/NGROK.EXE -OUTFILE NGROK.EXE
        INVOKE-WEBREQUEST HTTPS://GITHUB.COM/AVGCHAMARA/WINDOWSRDP/RAW/MAIN/NSSM.EXE -OUTFILE NSSM.EXE
    - NAME: COPY NSSM & NGROK TO WINDOWS DIRECTORY.

      RUN: | 
        COPY NSSM.EXE C:\WINDOWS\SYSTEM32
        COPY NGROK.EXE C:\WINDOWS\SYSTEM32
    - NAME: CONNECT YOUR NGROK ACCOUNT

      RUN: .\NGROK.EXE AUTHTOKEN $ENV:NGROK_AUTH_TOKEN

      ENV:

        NGROK_AUTH_TOKEN: ${{ SECRETS.NGROK_AUTH_TOKEN }}

    - NAME: DOWNLOAD IMPORTANT FILES.

      RUN: |
        INVOKE-WEBREQUEST HTTPS://GITHUB.COM/AVGCHAMARA/WINDOWSRDP/RAW/MAIN/NGROK-AP.BAT -OUTFILE NGROK-AP.BAT
        INVOKE-WEBREQUEST HTTPS://GITHUB.COM/AVGCHAMARA/WINDOWSRDP/RAW/MAIN/NGROK-CHECK.BAT -OUTFILE NGROK-CHECK.BAT
        INVOKE-WEBREQUEST HTTPS://GITHUB.COM/AVGCHAMARA/WINDOWSRDP/RAW/MAIN/LOOP.BAT -OUTFILE LOOP.BAT
    - NAME: MAKE YML FILE FOR NGROK.

      RUN: START NGROK-AP.BAT

    - NAME: ENABLE RDP ACCESS.

      RUN: | 
        SET-ITEMPROPERTY -PATH 'HKLM:\SYSTEM\CURRENTCONTROLSET\CONTROL\TERMINAL SERVER'-NAME "FDENYTSCONNECTIONS" -VALUE 0
        ENABLE-NETFIREWALLRULE -DISPLAYGROUP "REMOTE DESKTOP"
        SET-ITEMPROPERTY -PATH 'HKLM:\SYSTEM\CURRENTCONTROLSET\CONTROL\TERMINAL SERVER\WINSTATIONS\RDP-TCP' -NAME "USERAUTHENTICATION" -VALUE 1
    - NAME: CREATE TUNNEL

      RUN: SC START NGROK

    - NAME: CONNECT TO YOUR RDP 2CORE-7GB RAM.

      RUN: CMD /C NGROK-CHECK.BAT

    - NAME: ALL DONE! YOU CAN CLOSE TAB NOW! MAXIMUM VM TIME:6H.

      RUN: CMD /C LOOP.BAT
